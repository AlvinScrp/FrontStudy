{"version":3,"file":"my-single-spa.js","sources":["../../src/applications/timeouts.js","../../src/applications/app.helper.js","../../src/lifecycles/bootstrap.js","../../src/lifecycles/unmount.js","../../src/lifecycles/mount.js","../../src/lifecycles/update.js","../../src/services/index.js","../../src/lifecycles/helper.js","../../src/lifecycles/load.js","../../src/start.js","../../src/navigation/hijackLocations.js","../../src/navigation/invoke.js","../../src/applications/apps.js","../../src/my-single-spa.js"],"sourcesContent":["/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n'use strict';\nconst DEFAULT_TIMEOUTS = {\n    bootstrap: {\n        // 超时毫秒数\n        milliseconds: 3000,\n        // 当超时，是否\n        rejectWhenTimeout: false\n    },\n    mount: {\n        // 超时毫秒数\n        milliseconds: 3000,\n        // 当超时，是否\n        rejectWhenTimeout: false\n    },\n    unmount: {\n        // 超时毫秒数\n        milliseconds: 3000,\n        // 当超时，是否\n        rejectWhenTimeout: false\n    },\n    unload: {\n        // 超时毫秒数\n        milliseconds: 3000,\n        // 当超时，是否\n        rejectWhenTimeout: false\n    }\n};\n\nexport function setBootstrapMaxTime(milliseconds, rejectWhenTimeout = false) {\n    if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n        throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n    }\n    DEFAULT_TIMEOUTS.bootstrap = {milliseconds, rejectWhenTimeout};\n}\n\n\nexport function setMountMaxTime(milliseconds, rejectWhenTimeout = false) {\n    if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n        throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n    }\n    DEFAULT_TIMEOUTS.mount = {milliseconds, rejectWhenTimeout};\n}\n\nexport function setUnmountMaxTime(milliseconds, rejectWhenTimeout = false) {\n    if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n        throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n    }\n    DEFAULT_TIMEOUTS.unmount = {milliseconds, rejectWhenTimeout};\n}\n\nexport function setUnloadMaxTime(milliseconds, rejectWhenTimeout = false) {\n    if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n        throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n    }\n    DEFAULT_TIMEOUTS.unload = {milliseconds, rejectWhenTimeout};\n}\n\nexport function ensureAppTimeouts(timeouts = {}) {\n    return {\n        ...DEFAULT_TIMEOUTS,\n        ...timeouts\n    }\n}\n\nexport function reasonableTime(promise, description, timeouts) {\n    return new Promise((resolve, reject) => {\n        let finished = false;\n\n        promise.then(data => {\n            finished = true;\n            resolve(data);\n        }).catch(e => {\n            finished = true;\n            reject(e);\n        });\n\n\n        setTimeout(() => maybeTimeout(), timeouts.milliseconds);\n\n        function maybeTimeout() {\n            if (finished) {\n                return;\n            }\n            let error = `${description} did not resolve or reject for ${timeouts.milliseconds} milliseconds`;\n            if (timeouts.rejectWhenTimeout) {\n                reject(new Error(error));\n            } else {\n                console.error(error);\n            }\n        }\n\n    });\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n'use strict';\n\n// 未加载\nexport const NOT_LOADED = 'NOT_LOADED';\n// 加载app代码中\nexport const LOAD_RESOURCE_CODE = 'LOAD_RESOURCE_CODE';\n// 加载成功，但为启动\nexport const NOT_BOOTSTRAPPED = 'NOT_BOOTSTRAPPED';\n// 启动中\nexport const BOOTSTRAPPING = 'BOOTSTRAPPING';\n// 启动成功，未挂载\nexport const NOT_MOUNTED = 'NOT_MOUNTED';\n// 挂载中\nexport const MOUNTING = 'MOUNTING';\n// 挂载成功\nexport const MOUNTED = 'MOUNTED';\n// 卸载中\nexport const UNMOUNTING = 'UNMOUNTING';\n// 加载时参数校验未通过，或非致命错误\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN';\n// 加载时遇到致命错误\nexport const LOAD_ERROR = 'LOAD_ERROR';\n// 更新service中\nexport const UPDATING = 'UPDATING';\n\n\nexport function notSkipped(app) {\n    return app.status !== SKIP_BECAUSE_BROKEN;\n}\n\nexport function withoutLoadError(app) {\n    return app.status !== LOAD_ERROR;\n}\n\nexport function isLoaded(app) {\n    return app.status !== NOT_LOADED && app.status !== LOAD_ERROR && app.status !== LOAD_RESOURCE_CODE;\n}\n\nexport function isntLoaded(app) {\n    return !isLoaded(app);\n}\n\nexport function isActive(app) {\n    return app.status === MOUNTED;\n}\n\nexport function isntActive(app) {\n    return !isActive(app)\n}\n\nexport function shouldBeActive(app) {\n    try {\n        return app.activityWhen(window.location);\n    } catch (e) {\n        app.status = SKIP_BECAUSE_BROKEN;\n        throw e;\n    }\n}\n\nexport function shouldntBeActive(app) {\n    try {\n        return !app.activityWhen(window.location);\n    } catch (e) {\n        app.status = SKIP_BECAUSE_BROKEN;\n        throw e;\n    }\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/21.\n */\n\n\n'use strict';\n\nimport {NOT_BOOTSTRAPPED, BOOTSTRAPPING, NOT_MOUNTED, SKIP_BECAUSE_BROKEN} from \"../applications/app.helper\";\nimport {reasonableTime} from '../applications/timeouts';\nimport {getProps} from './helper';\n\nexport function toBootstrapPromise(app) {\n    if (app.status !== NOT_BOOTSTRAPPED) {\n        return Promise.resolve(app);\n    }\n\n    app.status = BOOTSTRAPPING;\n\n    return reasonableTime(app.bootstrap(getProps(app)), `app: ${app.name} bootstrapping`, app.timeouts.bootstrap).then(() => {\n        app.status = NOT_MOUNTED;\n        return app;\n    }).catch(e => {\n        console.log(e);\n        app.status = SKIP_BECAUSE_BROKEN;\n        return app;\n    });\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/21.\n */\n\n\n'use strict';\n\nimport {MOUNTED, NOT_MOUNTED, SKIP_BECAUSE_BROKEN, UNMOUNTING} from \"../applications/app.helper\";\nimport {reasonableTime} from \"../applications/timeouts\";\nimport {getProps} from \"./helper\";\n\nexport function toUnmountPromise(app) {\n    if (app.status !== MOUNTED) {\n        return Promise.resolve(app);\n    }\n    app.status = UNMOUNTING;\n\n    function unmountThisApp(serviceUnmountError) {\n        return reasonableTime(app.unmount(getProps(app)), `app: ${app.name} unmounting`, app.timeouts.unmount).catch(e => {\n            console.log(e);\n            app.status = SKIP_BECAUSE_BROKEN;\n        }).then(() => {\n            if (app.status !== SKIP_BECAUSE_BROKEN) {\n                app.status = serviceUnmountError === true ? SKIP_BECAUSE_BROKEN : NOT_MOUNTED;\n            }\n            return app;\n        });\n    }\n\n    // 优先卸载当前app中的service，如果存在的话\n    let unmountServicePromise = Promise.all(Object.keys(app.services).map(name => app.services[name].unmountSelf()));\n\n    return unmountServicePromise.catch(e => {\n        console.log(e);\n        return true;\n    }).then(unmountThisApp);\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/21.\n */\n\n\n'use strict';\n\nimport {MOUNTED, NOT_MOUNTED, SKIP_BECAUSE_BROKEN,MOUNTING} from \"../applications/app.helper\";\nimport {reasonableTime} from \"../applications/timeouts\";\nimport {getProps} from \"./helper\";\nimport {toUnmountPromise} from './unmount';\n\nexport function toMountPromise(app) {\n    if (app.status !== NOT_MOUNTED) {\n        return Promise.resolve(app);\n    }\n    app.status = MOUNTING;\n    return reasonableTime(app.mount(getProps(app)), `app: ${app.name} mounting`, app.timeouts.mount).then(() => {\n        app.status = MOUNTED;\n    }).catch(e => {\n        console.log(e);\n        app.status = MOUNTED;\n\n        return toUnmountPromise(app).catch(e => {\n            console.log(e);\n        }).then(() => {\n            app.status = SKIP_BECAUSE_BROKEN;\n            return app;\n        });\n    })\n\n\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n\n\n'use strict';\nimport {\n    LOAD_ERROR,\n    LOAD_RESOURCE_CODE,\n    NOT_LOADED,\n    SKIP_BECAUSE_BROKEN,\n    NOT_BOOTSTRAPPED\n} from '../applications/app.helper';\n\nimport {getProps, smellLikeAPromise, validateLifeCyclesFn, flattenFnArray} from './helper';\n\nimport {ensureAppTimeouts} from '../applications/timeouts';\n\nexport function toUpdatePromise(app) {\n    // 状态不满足需要被load\n    if (app.status !== NOT_LOADED && app.status !== LOAD_ERROR) {\n        return Promise.resolve(app);\n    }\n\n    app.status = LOAD_RESOURCE_CODE;\n\n    const loadPromise = app.loadApp(getProps(app));\n\n    if (!smellLikeAPromise(loadPromise)) {\n        console.log('app loadFunction must return a promise');\n        app.status = SKIP_BECAUSE_BROKEN;\n        return Promise.resolve(app);\n    }\n\n    return loadPromise.then(module => {\n        let errorMsg = [];\n\n        if (typeof module !== 'object') {\n            errorMsg.push(`app:${app.name} dose not export anything`);\n        }\n\n        ['bootstrap', 'mount', 'unmount'].forEach(lifecycle => {\n            if (!validateLifeCyclesFn(module[lifecycle])) {\n                errorMsg.push(`app:${app.name} dost not export ${lifecycle} as a function or function array`);\n            }\n        });\n\n        if (errorMsg.length) {\n            console.log(errorMsg);\n            app.status = SKIP_BECAUSE_BROKEN;\n            return app;\n        }\n\n        app.status = NOT_BOOTSTRAPPED;\n        app.bootstrap = flattenFnArray(module.bootstrap, `app:${app.name} bootstrap functions`);\n        app.mount = flattenFnArray(module.mount, `app:${app.name} mount functions`);\n        app.unmount = flattenFnArray(module.unmount, `app:${app.name} unmount functions`);\n        app.unload = flattenFnArray(module.unload ? module.unload : [], `app:${app.name} unload functions`);\n        app.timeouts = ensureAppTimeouts(module.timeouts);\n\n\n        return app;\n\n    }).catch(e => {\n        console.log(e);\n        app.status = LOAD_ERROR;\n        return app;\n    });\n\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/22.\n */\n\n\n'use strict';\n\nimport {flattenFnArray, smellLikeAPromise, validateLifeCyclesFn} from \"../lifecycles/helper\";\nimport {\n    LOAD_RESOURCE_CODE,\n    MOUNTED,\n    NOT_BOOTSTRAPPED,\n    SKIP_BECAUSE_BROKEN\n} from '../applications/app.helper';\nimport {ensureAppTimeouts} from \"../applications/timeouts\";\nimport {toBootstrapPromise} from '../lifecycles/bootstrap';\nimport {toMountPromise} from '../lifecycles/mount';\nimport {toUnmountPromise} from '../lifecycles/unmount';\nimport {toUpdatePromise} from '../lifecycles/update';\n\n\nlet serviceIndex = 0;\n\nconst systemService = {services: {}};\n\n/**\n * 挂载系统服务\n * @return {{mount(): Promise, unmount(): Promise, update(Object): Promise, getStatus(): string}}\n */\nexport function mountSystemService() {\n    return mountService.apply(systemService, arguments);\n}\n\n/**\n * 根据名称获取系统服务\n * @param {string} serviceName 系统服务名称\n * @return {*|null}\n */\nexport function getSystemService(serviceName) {\n    return systemService[serviceName] || {};\n}\n\n/**\n * 挂载服务\n * @param {Object|Function<Promise>} config 服务配置或加载函数\n * @param {Object} props 传入服务的属性\n * @return {{mount(): Promise, unmount(): Promise, update(Object): Promise, getStatus(): string}}\n */\nexport function mountService(config, props = {}) {\n    if (!config || !/^(object|function)$/.test(typeof config)) {\n        throw new Error('cannot mount services without config or config load function');\n    }\n\n    const context = this;\n    serviceIndex++;\n\n    let loadServicePromise = typeof config === 'function' ? config() : () => Promise.resolve(config);\n\n    if (!smellLikeAPromise(loadServicePromise)) {\n        throw new Error('config load function must be a promise or thenable');\n    }\n\n    const service = {\n        id: serviceIndex,\n        // service 可以嵌套 service\n        services: {},\n        status: LOAD_RESOURCE_CODE,\n        props,\n        context\n    };\n\n\n    loadServicePromise = loadServicePromise.then(serviceConfig => {\n        let errorMsg = [];\n        const name = `service_${service.id}`;\n\n        if (typeof serviceConfig !== 'object') {\n            errorMsg.push(`service load function dose not export anything`);\n        }\n\n        ['bootstrap', 'mount', 'unmount', 'update'].forEach(lifecycle => {\n            // update是可选的\n            if (lifecycle === 'update' && !serviceConfig[lifecycle]) {\n                return;\n            }\n            if (!validateLifeCyclesFn(serviceConfig[lifecycle])) {\n                errorMsg.push(`service dost not export ${lifecycle} as a function or function array`);\n            }\n        });\n\n        if (errorMsg.length) {\n            service.status = SKIP_BECAUSE_BROKEN;\n            throw new Error(errorMsg.toString());\n        }\n\n        service.name = name;\n        service.status = NOT_BOOTSTRAPPED;\n        service.bootstrap = flattenFnArray(serviceConfig.bootstrap, `service bootstrap functions`);\n        service.mount = flattenFnArray(serviceConfig.mount, `service mount functions`);\n        service.unmount = flattenFnArray(serviceConfig.unmount, `service unmount functions`);\n        service.timeouts = ensureAppTimeouts(serviceConfig.timeouts);\n\n        if (serviceConfig.update) {\n            service.update = flattenFnArray(serviceConfig.update, 'service update functions');\n        }\n\n    });\n\n    loadServicePromise = loadServicePromise.then(() => toBootstrapPromise(service));\n\n    let actions = {\n        mount() {\n            return loadServicePromise.then(() => {\n                context.services[service.name] = service;\n                return toMountPromise(service);\n            }).then(() => {\n                if (service.status !== MOUNTED) {\n                    delete context.services[service.name];\n                }\n            });\n        },\n        unmount() {\n            return toUnmountPromise(service).then(() => {\n                delete context.services[service.name];\n            });\n        },\n        update(props = {}) {\n            service.props = props;\n            return toUpdatePromise(service)\n        },\n        getStatus() {\n            return service.status;\n        },\n        getRawData() {\n            return {...service};\n        }\n    };\n\n    service.unmountSelf = actions.unmount;\n    service.mountSelf = actions.mount;\n    service.updateSelf = actions.update;\n\n    return actions;\n\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n\n'use strict';\n\nimport * as mySingleSpa from '../my-single-spa';\nimport {mountService} from \"../services\";\n\nexport function getProps(app) {\n    return {\n        ...app.customProps,\n        name: app.name,\n        // 将此方法传入app中，让app可以在内部自由挂载服务\n        mountService: mountService.bind(app),\n        mySingleSpa\n    };\n}\n\nexport function smellLikeAPromise(promise) {\n    if (promise instanceof Promise) {\n        return true;\n    }\n    return typeof promise === 'object' && promise.then === 'function' && promise.catch === 'function';\n}\n\nexport function validateLifeCyclesFn(fn) {\n    if (typeof fn === 'function') {\n        return true;\n    }\n    if (Array.isArray(fn)) {\n        return fn.filter(item => typeof item !== 'function').length === 0;\n    }\n    return false;\n}\n\nexport function flattenFnArray(fns, description) {\n    if (!Array.isArray(fns)) {\n        fns = [fns];\n    }\n\n    if (fns.length === 0) {\n        fns = [() => Promise.resolve()];\n    }\n\n    return function (props) {\n        return new Promise((resolve, reject) => {\n            waitForPromises(0);\n\n            function waitForPromises(index) {\n                let fn = fns[index](props);\n                if (!smellLikeAPromise(fn)) {\n                    reject(`${description} at index ${index} did not return a promise`);\n                    return;\n                }\n                fn.then(() => {\n                    if (index === fns.length - 1) {\n                        resolve();\n                    } else {\n                        waitForPromises(++index);\n                    }\n                }).catch((e) => {\n                    reject(e);\n                });\n            }\n\n        });\n    }\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n\n\n'use strict';\nimport {\n    LOAD_ERROR,\n    LOAD_RESOURCE_CODE,\n    NOT_LOADED,\n    SKIP_BECAUSE_BROKEN,\n    NOT_BOOTSTRAPPED\n} from '../applications/app.helper';\n\nimport {getProps, smellLikeAPromise, validateLifeCyclesFn, flattenFnArray} from './helper';\n\nimport {ensureAppTimeouts} from '../applications/timeouts';\n\nexport function toLoadPromise(app) {\n    // 状态不满足需要被load\n    if (app.status !== NOT_LOADED && app.status !== LOAD_ERROR) {\n        return Promise.resolve(app);\n    }\n\n    app.status = LOAD_RESOURCE_CODE;\n\n    const loadPromise = app.loadApp(getProps(app));\n\n    if (!smellLikeAPromise(loadPromise)) {\n        console.log('app loadFunction must return a promise');\n        app.status = SKIP_BECAUSE_BROKEN;\n        return Promise.resolve(app);\n    }\n\n    return loadPromise.then(module => {\n        let errorMsg = [];\n\n        if (typeof module !== 'object') {\n            errorMsg.push(`app:${app.name} dose not export anything`);\n        }\n\n        ['bootstrap', 'mount', 'unmount'].forEach(lifecycle => {\n            if (!validateLifeCyclesFn(module[lifecycle])) {\n                errorMsg.push(`app:${app.name} dost not export ${lifecycle} as a function or function array`);\n            }\n        });\n\n        if (errorMsg.length) {\n            console.log(errorMsg);\n            app.status = SKIP_BECAUSE_BROKEN;\n            return app;\n        }\n\n        app.status = NOT_BOOTSTRAPPED;\n        app.bootstrap = flattenFnArray(module.bootstrap, `app:${app.name} bootstrap functions`);\n        app.mount = flattenFnArray(module.mount, `app:${app.name} mount functions`);\n        app.unmount = flattenFnArray(module.unmount, `app:${app.name} unmount functions`);\n        app.unload = flattenFnArray(module.unload ? module.unload : [], `app:${app.name} unload functions`);\n        app.timeouts = ensureAppTimeouts(module.timeouts);\n\n\n        return app;\n\n    }).catch(e => {\n        console.log(e);\n        app.status = LOAD_ERROR;\n        return app;\n    });\n\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n\n'use strict';\nimport {invoke} from './navigation/invoke';\n\nlet started = false;\n\nexport function start() {\n    if (started) {\n        return;\n    }\n    started = true;\n    return invoke();\n}\n\nexport function isStarted() {\n    return started;\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/21.\n */\n\n'use strict';\n\n// onhashchange onpopstate history.pushState() history.replaceState()\n\nimport {invoke} from \"./invoke\";\n\nconst HIJACK_EVENTS_NAME = /^(hashchange|popstate)$/i;\nconst EVENTS_POOL = {\n    hashchange: [],\n    popstate: []\n};\n\nfunction reroute() {\n    invoke([], arguments);\n}\n\nwindow.addEventListener('hashchange', reroute);\nwindow.addEventListener('popstate', reroute);\n\n// 拦截所有注册的事件，以便确保这里的事件总是第一个执行\nconst originalAddEventListener = window.addEventListener;\nconst originalRemoveEventListener = window.removeEventListener;\nwindow.addEventListener = function (eventName, handler, args) {\n    console.log('addEventListener',eventName,handler,args);\n    if (eventName && HIJACK_EVENTS_NAME.test(eventName) && typeof handler === 'function') {\n        EVENTS_POOL[eventName].indexOf(handler) === -1 && EVENTS_POOL[eventName].push(handler);\n    }\n    return originalAddEventListener.apply(this, arguments);\n};\n\nwindow.removeEventListener = function (eventName, handler) {\n    console.log('removeEventListener',eventName,handler);\n    if (eventName && HIJACK_EVENTS_NAME.test(eventName) && typeof handler === 'function') {\n        let eventList = EVENTS_POOL[eventName];\n        eventList.indexOf(handler) > -1 && (EVENTS_POOL[eventName] = eventList.filter(fn => fn !== handler));\n    }\n    return originalRemoveEventListener.apply(this, arguments);\n};\n\n\n// 拦截history的方法，因为pushState和replaceState方法并不会触发onpopstate事件，所以我们即便在onpopstate时执行了reroute方法，也要在这里执行下reroute方法。\nconst originalHistoryPushState = window.history.pushState;\nconst originalHistoryReplaceState = window.history.replaceState;\nwindow.history.pushState = function (state, title, url) {\n    let result = originalHistoryPushState.apply(this, arguments);\n    reroute(mockPopStateEvent(state));\n    return result;\n};\nwindow.history.replaceState = function (state, title, url) {\n    let result = originalHistoryReplaceState.apply(this, arguments);\n    reroute(mockPopStateEvent(state));\n    return result;\n};\n\nfunction mockPopStateEvent(state) {\n    return new PopStateEvent('popstate', {state});\n}\n\nexport function callCapturedEvents(eventArgs) {\n    if (!eventArgs) {\n        return;\n    }\n    if (Array.isArray(eventArgs)) {\n        eventArgs = eventArgs[0];\n    }\n    let name = eventArgs.type;\n    if (!HIJACK_EVENTS_NAME.test(name)) {\n        return;\n    }\n    EVENTS_POOL[name].forEach(handler => handler.apply(window, eventArgs));\n}\n","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n\n'use strict';\n\nimport {getAppsToLoad, getAppsToMount, getAppsToUnmount, getMountedApps} from '../applications/apps';\nimport {toLoadPromise} from '../lifecycles/load';\nimport {toBootstrapPromise} from '../lifecycles/bootstrap';\nimport {toMountPromise} from '../lifecycles/mount';\nimport {toUnmountPromise} from '../lifecycles/unmount';\nimport {isStarted} from '../start';\nimport {callCapturedEvents} from './hijackLocations';\n\nlet loadAppsUnderway = false;\nlet pendingPromises = [];\n\nexport function invoke(pendings, eventArgs) {\n    console.log('invoke',pendings,eventArgs);\n    if (loadAppsUnderway) {\n        return new Promise((resolve, reject) => {\n            pendingPromises.push({success: resolve, failure: reject, eventArgs});\n        });\n    }\n\n    loadAppsUnderway = true;\n    if (isStarted()) {\n        console.log('isStarted');\n        return performAppChanges();\n    }\n    return loadApps();\n\n\n    // 找到需要load的app\n    function loadApps() {\n        console.log('loadApps');\n        let loadPromises = getAppsToLoad().map(toLoadPromise);\n        console.log('loadPromises',loadPromises);\n        return Promise.all(loadPromises).then(() => {\n            console.log('then callAllLocationEvents');\n            callAllLocationEvents();\n            console.log('finish');\n            return finish();\n        }).catch(e => {\n            console.log('catch callAllLocationEvents');\n            callAllLocationEvents();\n            console.log(e);\n        });\n    }\n\n\n    // 启动app\n    function performAppChanges() {\n        console.log('performAppChanges');\n        // getAppsToUnmount\n        let unmountApps = getAppsToUnmount();\n        let unmountPromises = Promise.all(unmountApps.map(toUnmountPromise));\n\n        // getAppsToLoad\n        let loadApps = getAppsToLoad();\n        let loadPromises = loadApps.map(app => {\n            return toLoadPromise(app).then(app => toBootstrapPromise(app))\n                .then(() => unmountPromises).then(() => toMountPromise(app))\n        });\n\n        let mountApps = getAppsToMount().filter(app => loadApps.indexOf(app) === -1);\n        let mountPromises = mountApps.map(app => {\n            return toBootstrapPromise(app).then(() => unmountPromises).then(() => toMountPromise(app));\n        });\n\n        return unmountPromises.then(() => {\n            callAllLocationEvents();\n            let loadAndMountPromises = loadPromises.concat(mountPromises);\n            return Promise.all(loadAndMountPromises).then(finish, ex => {\n                pendings.forEach(item => item.reject(ex));\n                throw ex;\n            });\n        }, e => {\n            callAllLocationEvents();\n            console.log(e);\n            throw e;\n        });\n    }\n\n\n    function finish() {\n        let resolveValue = getMountedApps();\n        if (pendings) {\n            pendings.forEach(item => item.success(resolveValue));\n        }\n\n        loadAppsUnderway = false;\n\n        if (pendingPromises.length) {\n            const backup = pendingPromises;\n            pendingPromises = [];\n            return invoke(backup);\n        }\n\n        return resolveValue;\n    }\n\n    function callAllLocationEvents() {\n        pendings && pendings.length && pendings.filter(item => item.eventArgs).forEach(item => callCapturedEvents(item.eventArgs));\n        eventArgs && callCapturedEvents(eventArgs);\n    }\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n\n'use strict';\n\nimport {\n    NOT_LOADED,\n    notSkipped,\n    withoutLoadError,\n    isntLoaded,\n    shouldBeActive,\n    shouldntBeActive,\n    isLoaded,\n    isntActive,\n    isActive\n} from './app.helper';\nimport {invoke} from '../navigation/invoke';\n\nconst APPS = [];\n\n\n/**\n * 获取满足加载条件的app\n * 1、没有加载中断\n * 2、没有加载错误\n * 3、没有被加载过\n * 4、满足app.activityWhen()\n * @return {*[]}\n */\nexport function getAppsToLoad() {\n    return APPS.filter(notSkipped).filter(withoutLoadError).filter(isntLoaded).filter(shouldBeActive);\n}\n\n/**\n * 需要mount的app\n * 1、没有加载中断\n * 2、加载过的\n * 3、当前没有mounted的\n * 4、需要被mounted的\n */\nexport function getAppsToMount() {\n    return APPS.filter(notSkipped).filter(isLoaded).filter(isntActive).filter(shouldBeActive);\n}\n\n/**\n * 需要被unmount的app\n * 1、没有加载中断\n * 2、正在挂载的\n * 3、需要卸载的\n */\nexport function getAppsToUnmount() {\n    return APPS.filter(notSkipped).filter(isActive).filter(shouldntBeActive);\n}\n\n/**\n * 获取所有的App名称\n * @return {string[]}\n */\nexport function getAppNames() {\n    return APPS.map(function (item) {\n        return item.name;\n    });\n}\n\nexport function getAppStatus(name) {\n    if (!name) {\n        return APPS.map(item => item.status);\n    }\n    let app = APPS.find(item => item.name === name);\n    return app ? app.status : null;\n}\n\nexport function getRawApps() {\n    return [...APPS];\n}\n\nexport function getMountedApps() {\n    return APPS.filter(isActive).map(item => item.name);\n}\n\n/**\n * 注册application\n * @param {string} appName application名称\n * @param {Object|Function<Promise>} applicationOrLoadFunction app配置或app异步加载函数\n * @param {Function<Boolean>} activityWhen 判断是否应该被挂载\n * @param {Object} customProps 自定义配置\n * @return {Promise}\n */\nexport function registerApplication(appName, applicationOrLoadFunction, activityWhen, customProps = {}) {\n    if (!appName || typeof appName !== 'string') {\n        throw new Error('the app name must be a non-empty string');\n    }\n    if (getAppNames().indexOf(appName) !== -1) {\n        throw new Error('There is already an app declared with name ' + appName);\n    }\n    if (typeof customProps !== 'object' || Array.isArray(customProps)) {\n        throw new Error('the customProps must be a pure object');\n    }\n\n    if (!applicationOrLoadFunction) {\n        throw new Error('the application or load function is required');\n    }\n\n    if (typeof activityWhen !== 'function') {\n        throw new Error('the activityWhen must be a function');\n    }\n\n    if (typeof applicationOrLoadFunction !== 'function') {\n        applicationOrLoadFunction = () => Promise.resolve(applicationOrLoadFunction);\n    }\n\n    APPS.push({\n        name: appName,\n        loadApp: applicationOrLoadFunction,\n        activityWhen,\n        customProps,\n        status: NOT_LOADED,\n        services: {}\n    });\n\n    return invoke();\n}","/**\n * @file\n * Created by zhangyatao on 2019/10/20.\n */\n'use strict';\nexport {setBootstrapMaxTime, setMountMaxTime, setUnloadMaxTime, setUnmountMaxTime} from './applications/timeouts';\nexport {registerApplication, getAppNames, getAppStatus, getRawApps} from './applications/apps'\nexport {start} from './start';\nexport {mountSystemService, getSystemService} from './services';\nexport {\n    NOT_LOADED,\n    LOAD_RESOURCE_CODE,\n    NOT_BOOTSTRAPPED,\n    BOOTSTRAPPING,\n    NOT_MOUNTED,\n    MOUNTED,\n    UNMOUNTING,\n    LOAD_ERROR,\n    SKIP_BECAUSE_BROKEN\n} from './applications/app.helper'"],"names":["DEFAULT_TIMEOUTS","bootstrap","milliseconds","rejectWhenTimeout","mount","unmount","unload","setBootstrapMaxTime","Error","type","setMountMaxTime","setUnmountMaxTime","setUnloadMaxTime","ensureAppTimeouts","timeouts","reasonableTime","promise","description","Promise","resolve","reject","finished","then","data","catch","e","setTimeout","maybeTimeout","error","console","NOT_LOADED","LOAD_RESOURCE_CODE","NOT_BOOTSTRAPPED","BOOTSTRAPPING","NOT_MOUNTED","MOUNTING","MOUNTED","UNMOUNTING","SKIP_BECAUSE_BROKEN","LOAD_ERROR","notSkipped","app","status","withoutLoadError","isLoaded","isntLoaded","isActive","isntActive","shouldBeActive","activityWhen","window","location","shouldntBeActive","toBootstrapPromise","getProps","name","log","toUnmountPromise","unmountThisApp","serviceUnmountError","unmountServicePromise","all","Object","keys","services","map","unmountSelf","toMountPromise","toUpdatePromise","loadPromise","loadApp","smellLikeAPromise","module","errorMsg","push","forEach","lifecycle","validateLifeCyclesFn","length","flattenFnArray","serviceIndex","systemService","mountSystemService","mountService","apply","arguments","getSystemService","serviceName","config","props","test","context","loadServicePromise","service","id","serviceConfig","toString","update","actions","getStatus","getRawData","mountSelf","updateSelf","customProps","bind","mySingleSpa","fn","Array","isArray","filter","item","fns","waitForPromises","index","toLoadPromise","started","start","invoke","isStarted","HIJACK_EVENTS_NAME","EVENTS_POOL","hashchange","popstate","reroute","addEventListener","originalAddEventListener","originalRemoveEventListener","removeEventListener","eventName","handler","args","indexOf","eventList","originalHistoryPushState","history","pushState","originalHistoryReplaceState","replaceState","state","title","url","result","mockPopStateEvent","PopStateEvent","callCapturedEvents","eventArgs","loadAppsUnderway","pendingPromises","pendings","success","failure","performAppChanges","loadApps","loadPromises","getAppsToLoad","callAllLocationEvents","finish","unmountApps","getAppsToUnmount","unmountPromises","mountApps","getAppsToMount","mountPromises","loadAndMountPromises","concat","ex","resolveValue","getMountedApps","backup","APPS","getAppNames","getAppStatus","find","getRawApps","registerApplication","appName","applicationOrLoadFunction"],"mappings":"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"}